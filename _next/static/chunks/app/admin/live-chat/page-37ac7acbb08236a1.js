(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6722],{30285:(e,s,r)=>{"use strict";r.d(s,{$:()=>o,r:()=>i});var t=r(95155),a=r(12115),l=r(66634),n=r(74466),d=r(59434);let i=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-all duration-200 ease-in-out hover:-translate-y-0.5 active:translate-y-0 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=a.forwardRef((e,s)=>{let{className:r,variant:a,size:n,asChild:o=!1,...c}=e,u=o?l.DX:"button";return(0,t.jsx)(u,{className:(0,d.cn)(i({variant:a,size:n,className:r})),ref:s,...c})});o.displayName="Button"},56104:(e,s,r)=>{"use strict";r.d(s,{db:()=>i});var t=r(23915),a=r(35317),l=r(49509);let n={apiKey:l.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:l.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:l.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:l.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:l.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:l.env.NEXT_PUBLIC_FIREBASE_APP_ID},d=(0,t.Dk)().length?(0,t.Sx)():(0,t.Wp)(n),i=(0,a.aU)(d)},62523:(e,s,r)=>{"use strict";r.d(s,{p:()=>n});var t=r(95155),a=r(12115),l=r(59434);let n=a.forwardRef((e,s)=>{let{className:r,type:a,...n}=e;return(0,t.jsx)("input",{type:a,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:s,...n})});n.displayName="Input"},66424:(e,s,r)=>{"use strict";r.d(s,{F:()=>d});var t=r(95155),a=r(12115),l=r(47655),n=r(59434);let d=a.forwardRef((e,s)=>{let{className:r,children:a,viewportRef:d,...o}=e;return(0,t.jsxs)(l.bL,{ref:s,className:(0,n.cn)("relative overflow-hidden",r),...o,children:[(0,t.jsx)(l.LM,{ref:d,className:"h-full w-full rounded-[inherit]",children:a}),(0,t.jsx)(i,{}),(0,t.jsx)(l.OK,{})]})});d.displayName=l.bL.displayName;let i=a.forwardRef((e,s)=>{let{className:r,orientation:a="vertical",...d}=e;return(0,t.jsx)(l.VM,{ref:s,orientation:a,className:(0,n.cn)("flex touch-none select-none transition-colors","vertical"===a&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===a&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...d,children:(0,t.jsx)(l.lr,{className:"relative flex-1 rounded-full bg-border"})})});i.displayName=l.VM.displayName},66695:(e,s,r)=>{"use strict";r.d(s,{BT:()=>o,Wu:()=>c,ZB:()=>i,Zp:()=>n,aR:()=>d,wL:()=>u});var t=r(95155),a=r(12115),l=r(59434);let n=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("div",{ref:s,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...a})});n.displayName="Card";let d=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("div",{ref:s,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",r),...a})});d.displayName="CardHeader";let i=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("div",{ref:s,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",r),...a})});i.displayName="CardTitle";let o=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("div",{ref:s,className:(0,l.cn)("text-sm text-muted-foreground",r),...a})});o.displayName="CardDescription";let c=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("div",{ref:s,className:(0,l.cn)("p-6 pt-0",r),...a})});c.displayName="CardContent";let u=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("div",{ref:s,className:(0,l.cn)("flex items-center p-6 pt-0",r),...a})});u.displayName="CardFooter"},86116:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>y});var t=r(95155),a=r(12115),l=r(56104),n=r(35317),d=r(22100),i=r(66695),o=r(66424),c=r(91394),u=r(62523),f=r(30285),m=r(91721),x=r(70154),h=r(73503),p=r(50172),g=r(73672),v=r(59434),N=r(35095);function j(e){let{sessions:s,selectedSessionId:r,onSelectSession:a}=e;return(0,t.jsxs)(i.Zp,{className:"w-1/3",children:[(0,t.jsx)(i.aR,{children:(0,t.jsx)(i.ZB,{children:"Active Chats"})}),(0,t.jsx)(i.Wu,{children:(0,t.jsx)(o.F,{className:"h-[calc(80vh-100px)]",children:(0,t.jsx)("div",{className:"space-y-2",children:s.map(e=>(0,t.jsxs)("button",{onClick:()=>a(e.id),className:(0,v.cn)("w-full text-left p-3 rounded-lg flex items-center gap-4 transition-colors",r===e.id?"bg-secondary":"hover:bg-secondary/50"),children:[(0,t.jsxs)(c.eu,{className:"h-10 w-10",children:[(0,t.jsx)(c.BK,{src:e.userAvatar}),(0,t.jsx)(c.q5,{children:(0,t.jsx)(m.A,{})})]}),(0,t.jsxs)("div",{className:"flex-1 overflow-hidden",children:[(0,t.jsx)("p",{className:"font-semibold truncate",children:e.userName}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground truncate",children:e.lastMessageText})]}),(0,t.jsxs)("div",{className:"text-xs text-muted-foreground text-right space-y-1",children:[(0,t.jsx)("p",{children:e.lastMessageAt?(0,N.m)(e.lastMessageAt.toDate(),{addSuffix:!0}):""}),e.hasUnreadUserMessages&&(0,t.jsx)(x.A,{className:"w-3 h-3 text-primary fill-primary ml-auto"})]})]},e.id))})})})]})}function b(e){let{session:s,adminUser:r}=e,[d,x]=(0,a.useState)([]),[N,j]=(0,a.useState)(!1),[b,y]=(0,a.useState)(""),w=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(!s)return void x([]);let e=(0,n.rJ)(l.db,"chatSessions",s.id,"messages"),r=(0,n.P)(e,(0,n.My)("timestamp","asc"));j(!0);let t=(0,n.aQ)(r,e=>{x(e.docs.map(e=>({id:e.id,...e.data()}))),j(!1);let r=(0,n.H9)(l.db,"chatSessions",s.id);(0,n.x7)(r).then(e=>{e.exists()&&e.data().hasUnreadUserMessages&&(0,n.mZ)(r,{hasUnreadUserMessages:!1})})},e=>{console.error("Error fetching messages:",e),j(!1)});return()=>t()},[s]),(0,a.useEffect)(()=>{setTimeout(()=>{w.current&&w.current.scrollTo({top:w.current.scrollHeight,behavior:"smooth"})},100)},[d]);let _=async e=>{if(e.preventDefault(),!b.trim()||!s)return;y("");let t={sender:"admin",text:b,timestamp:(0,n.O5)(),userName:r.name,userAvatar:r.avatar};await (0,n.gS)((0,n.rJ)(l.db,"chatSessions",s.id,"messages"),t),await (0,n.mZ)((0,n.H9)(l.db,"chatSessions",s.id),{lastMessageText:b,lastMessageAt:(0,n.O5)(),hasUnreadAdminMessages:!0})};if(!s)return(0,t.jsx)("div",{className:"flex-1 flex items-center justify-center text-muted-foreground",children:(0,t.jsx)("p",{children:"Select a chat to start messaging"})});let E=()=>(0,t.jsxs)(c.eu,{className:"h-8 w-8",children:[(0,t.jsx)(c.BK,{src:s.userAvatar}),(0,t.jsx)(c.q5,{children:(0,t.jsx)(m.A,{})})]}),S=()=>(0,t.jsx)(c.eu,{className:"h-8 w-8",children:(0,t.jsx)(c.q5,{children:(0,t.jsx)(h.A,{})})});return(0,t.jsxs)(i.Zp,{className:"flex-1 flex flex-col h-[80vh]",children:[(0,t.jsx)(i.aR,{className:"border-b",children:(0,t.jsx)(i.ZB,{children:s.userName})}),(0,t.jsx)(i.Wu,{className:"flex-1 p-0 overflow-hidden",children:(0,t.jsx)(o.F,{className:"h-full",viewportRef:w,children:(0,t.jsx)("div",{className:"p-4 space-y-4",children:N?(0,t.jsx)(p.A,{className:"mx-auto my-4 h-6 w-6 animate-spin text-muted-foreground"}):d.map(e=>(0,t.jsxs)("div",{className:(0,v.cn)("flex items-end gap-2 max-w-[90%]","admin"===e.sender?"ml-auto justify-end":"mr-auto justify-start"),children:["user"===e.sender&&(0,t.jsx)(E,{}),(0,t.jsx)("div",{className:(0,v.cn)("rounded-lg px-3 py-2 text-sm","admin"===e.sender?"bg-primary text-primary-foreground rounded-br-none":"bg-secondary rounded-bl-none"),children:(0,t.jsx)("p",{className:"whitespace-pre-wrap",children:e.text})}),"admin"===e.sender&&(0,t.jsx)(S,{})]},e.id))})})}),(0,t.jsx)("div",{className:"p-4 border-t",children:(0,t.jsxs)("form",{onSubmit:_,className:"flex w-full items-center space-x-2",children:[(0,t.jsx)(u.p,{value:b,onChange:e=>y(e.target.value),placeholder:"Reply to ".concat(s.userName,"..."),autoComplete:"off"}),(0,t.jsx)(f.$,{type:"submit",size:"icon",children:(0,t.jsx)(g.A,{className:"h-4 w-4"})})]})})]})}function y(){let{user:e}=(0,d.A)(),[s,r]=(0,a.useState)([]),[i,o]=(0,a.useState)(null),[c,u]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let e=(0,n.P)((0,n.rJ)(l.db,"chatSessions"),(0,n.My)("lastMessageAt","desc")),s=(0,n.aQ)(e,e=>{r(e.docs.map(e=>({id:e.id,...e.data()}))),u(!1)},e=>{console.error("Failed to fetch sessions:",e),u(!1)});return()=>s()},[]);let f=s.find(e=>e.id===i)||null;return c?(0,t.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,t.jsx)(p.A,{className:"h-8 w-8 animate-spin text-primary"})}):(0,t.jsxs)("div",{className:"flex gap-6 h-full",children:[(0,t.jsx)(j,{sessions:s,selectedSessionId:i,onSelectSession:o}),(0,t.jsx)(b,{session:f,adminUser:e})]})}},91394:(e,s,r)=>{"use strict";r.d(s,{BK:()=>i,eu:()=>d,q5:()=>o});var t=r(95155),a=r(12115),l=r(85977),n=r(59434);let d=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)(l.bL,{ref:s,className:(0,n.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",r),...a})});d.displayName=l.bL.displayName;let i=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)(l._V,{ref:s,className:(0,n.cn)("aspect-square h-full w-full",r),...a})});i.displayName=l._V.displayName;let o=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)(l.H4,{ref:s,className:(0,n.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",r),...a})});o.displayName=l.H4.displayName},97913:(e,s,r)=>{Promise.resolve().then(r.bind(r,86116))}},e=>{var s=s=>e(e.s=s);e.O(0,[2992,8918,5856,7148,106,4337,7881,6967,8441,1684,7358],()=>s(97913)),_N_E=e.O()}]);